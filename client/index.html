<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Oblig 2</title>
    <meta name="description" content="Oblig 2" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <script type="module">
      import { createUser, getUsers } from "./api.js";
      localStorage.removeItem("swagbot_user")
      localStorage.removeItem("swagbot_room")

      const registerForm = document.getElementById("registerForm");
      registerForm.addEventListener("submit", handleSubmit);
      /*const enterRoomForm = document.getElementById("enterRoomForm");
      enterRoomForm.addEventListener("submit", handleEnterRoom);

      const getUsersButton = document.getElementById("getUsersBtn");
      getUsersButton.addEventListener("click", handleGetUsers);*/

      async function handleGetUsers() {
        const res = await getUsers();
        const formattedUsers = res.users.map((user) => `<li>${user.name}</li>`);
        document.getElementById("userList").innerHTML = formattedUsers;
      }

      async function handleSubmit(e) {
        e.preventDefault();
        const name = document.getElementById("name");
        console.log(name.value)
        if (name.value === "") {
          alert("You have to provide a name");
          name.focus();
          return;
        }
        try {
          const { data } = await createUser(name.value);
          console.log(data);
          if (typeof data !== "undefined") {
            localStorage.removeItem("swagbot_user");
            localStorage.setItem("swagbot_user", JSON.stringify(data));
          }
          window.location = 'choose-room'
        } catch (err) {
          alert(err);
          return;
        }
      }

      function handleEnterRoom() {
        window.location.hash = selectedRoom;
      }
    </script>

    <h1>Chatteprogram</h1>
    <main>
      <div class="container">
        <section class="form">
          <h2>Register</h2>
          <form id="registerForm" onsubmit="return false">
            <label>
              Name:
              <input type="text" id="name" name="name" />
            </label>

            <!--  <label>
              Room:
              <select id="room_id"></select>
            </label> -->
            <button type="submit">Create user</button>
          </form>
        </section>
        <!--     <section>
          <h2>Users</h2>
          <button id="getUsersBtn">Show</button>
          <ul id="userList"></ul>
        </section> -->
      </div>
    </main>
  </body>
</html>
